{"version":3,"file":"Tooltip-53a444ab.js","sources":["../../src/components/Tooltip/TooltipContext.ts","../../src/components/Tooltip/useTooltip.ts","../../src/components/Tooltip/Tooltip.tsx"],"sourcesContent":["/*\n *\n * Copyright 2024 New Vector Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * /\n */\n\nimport { createContext, useContext } from \"react\";\nimport { useTooltip } from \"./useTooltip\";\n\ntype ContextType = ReturnType<typeof useTooltip> | null;\n/**\n * The context for the Tooltip components.\n */\nexport const TooltipContext = createContext<ContextType>(null);\n\n/**\n * Provides the context for the Tooltip components.\n */\nexport function useTooltipContext() {\n  const context = useContext(TooltipContext);\n\n  if (context == null) {\n    throw new Error(\"Tooltip components must be wrapped in <Tooltip />\");\n  }\n\n  return context;\n}\n","/*\n *\n * Copyright 2024 New Vector Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * /\n */\n\nimport {\n  arrow,\n  autoUpdate,\n  flip,\n  offset,\n  OpenChangeReason,\n  Placement,\n  shift,\n  useDismiss,\n  useFloating,\n  useFocus,\n  useHover,\n  useId,\n  useInteractions,\n  useRole,\n} from \"@floating-ui/react\";\nimport { useMemo, useRef, useState } from \"react\";\n\ninterface UseTooltipProps {\n  /**\n   * The controlled open state of the tooltip.\n   * When true, the tooltip is always open. When false, the tooltip is always hidden.\n   * When undefined, the tooltip will manage its own open state.\n   * You will mostly want to omit this property. Will be used the vast majority\n   * of the time during development.\n   * @default undefined\n   */\n  open?: boolean;\n  /**\n   * The placement of the release announcement.\n   */\n  placement: Placement;\n  /**\n   * The caption of the tooltip.\n   */\n  caption?: string;\n  /**\n   * The event handler for the open change.\n   * If provided, the tooltip will be in controlled mode.\n   */\n  onOpenChange?: (\n    open: boolean,\n    event?: Event | undefined,\n    reason?: OpenChangeReason | undefined,\n  ) => void;\n  /**\n   * Whether the trigger element is interactive.\n   * When trigger is interactive:\n   *      - tooltip will be shown after a 300ms delay.\n   * When trigger is not interactive:\n   *      - tooltip will be shown instantly when pointer enters trigger.\n   *      - trigger will be wrapped in a span with a tab index from prop nonInteractiveTriggerTabIndex\n   * @default true\n   */\n  isTriggerInteractive: boolean;\n}\n\nexport function useTooltip({\n  open: controlledOpen,\n  placement,\n  onOpenChange: setControlledOpen,\n  isTriggerInteractive,\n  caption,\n}: UseTooltipProps) {\n  // Set on `aria-labelledby` attribute\n  const labelId = useId();\n  // Set on `aria-describedby` attribute\n  const captionId = useId();\n  const arrowRef = useRef(null);\n\n  const [uncontrolledOpen, setUncontrolledOpen] = useState(false);\n\n  // Use controlledOpen if it is provided, otherwise use uncontrolledOpen\n  const open = controlledOpen ?? uncontrolledOpen;\n  const setOpen = setControlledOpen ?? setUncontrolledOpen;\n\n  const data = useFloating({\n    placement,\n    open,\n    onOpenChange: setOpen,\n    whileElementsMounted: autoUpdate,\n    middleware: [\n      // arrow height 6px\n      offset(6),\n      flip({\n        crossAxis: placement.includes(\"-\"),\n        fallbackAxisSideDirection: \"start\",\n        padding: 5,\n      }),\n      shift({ padding: 5 }),\n      // add the little arrow along with the floating content\n      arrow({\n        element: arrowRef,\n      }),\n    ],\n  });\n\n  const context = data.context;\n  const hover = useHover(context, {\n    move: false,\n    enabled: controlledOpen === undefined,\n    // Show tooltip after a delay when trigger is interactive\n    delay: { open: isTriggerInteractive ? 300 : 0 },\n  });\n  const focus = useFocus(context, {\n    enabled: controlledOpen === undefined,\n  });\n  const dismiss = useDismiss(context);\n  const role = useRole(context, { role: \"tooltip\" });\n\n  const interactions = useInteractions([hover, focus, dismiss, role]);\n\n  return useMemo(\n    () => ({\n      labelId,\n      captionId: caption ? captionId : undefined,\n      open,\n      setOpen,\n      ...interactions,\n      ...data,\n      arrowRef,\n    }),\n    [labelId, captionId, open, setOpen, interactions, data, arrowRef],\n  );\n}\n","/*\nCopyright 2023-2024 New Vector Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { TooltipContext, useTooltipContext } from \"./TooltipContext\";\nimport {\n  FloatingArrow,\n  FloatingPortal,\n  Placement,\n  useMergeRefs,\n} from \"@floating-ui/react\";\nimport React, {\n  PropsWithChildren,\n  Ref,\n  JSX,\n  isValidElement,\n  cloneElement,\n} from \"react\";\n\nimport classNames from \"classnames\";\nimport styles from \"./Tooltip.module.css\";\nimport { useTooltip } from \"./useTooltip\";\n\ntype UseTooltipParam = Parameters<typeof useTooltip>[0];\n\ninterface TooltipProps\n  extends Omit<UseTooltipParam, \"placement\" | \"isTriggerInteractive\"> {\n  /**\n   * The placement of the component\n   * @default \"bottom\"\n   */\n  placement?: Placement;\n  /**\n   * Whether the trigger element is interactive.\n   * When trigger is interactive:\n   *      - tooltip will be shown after a 300ms delay.\n   * When trigger is not interactive:\n   *      - tooltip will be shown instantly when pointer enters trigger.\n   *      - trigger will be wrapped in a span with a tab index from prop nonInteractiveTriggerTabIndex\n   * @default true\n   */\n  isTriggerInteractive?: boolean;\n  /**\n   * The tab index for the non interactive trigger.\n   * @default 0\n   */\n  nonInteractiveTriggerTabIndex?: number;\n  /**\n   * The tooltip label\n   */\n  label: string;\n}\n\n/**\n * A tooltip component\n */\nexport function Tooltip({\n  children,\n  placement = \"bottom\",\n  isTriggerInteractive = true,\n  nonInteractiveTriggerTabIndex = 0,\n  label,\n  ...props\n}: PropsWithChildren<TooltipProps>) {\n  const context = useTooltip({ placement, isTriggerInteractive, ...props });\n\n  return (\n    <TooltipContext.Provider value={context}>\n      <TooltipAnchor>\n        {isTriggerInteractive ? (\n          children\n        ) : (\n          <span tabIndex={nonInteractiveTriggerTabIndex}>{children}</span>\n        )}\n      </TooltipAnchor>\n      <TooltipContent>\n        <span id={context.labelId}>{label}</span>\n        {/* Forcing dark theme, so that we have the correct contrast when\n              using the text color secondary on a solid dark background.\n              This is temporary and should only remain until we figure out\n              the approach to on-solid tokens */}\n        {props.caption && (\n          <span\n            id={context.captionId}\n            className={classNames(styles.caption, \"cpd-theme-dark\")}\n          >\n            {props.caption}\n          </span>\n        )}\n      </TooltipContent>\n    </TooltipContext.Provider>\n  );\n}\n\n/**\n * The content of the tooltip\n * @param children\n */\nfunction TooltipContent({\n  children,\n}: Readonly<PropsWithChildren>): JSX.Element | null {\n  const { context: floatingContext, arrowRef, ...rest } = useTooltipContext();\n\n  if (!floatingContext.open) return null;\n\n  return (\n    <FloatingPortal>\n      <div\n        ref={rest.refs.setFloating}\n        aria-labelledby={rest.labelId}\n        aria-describedby={rest.captionId || rest.labelId}\n        style={rest.floatingStyles}\n        {...rest.getFloatingProps()}\n        className={styles.tooltip}\n      >\n        <FloatingArrow\n          ref={arrowRef}\n          context={floatingContext}\n          // design absolute value\n          width={10}\n          height={6}\n          className={styles.arrow}\n        />\n        {children}\n      </div>\n    </FloatingPortal>\n  );\n}\n\n/**\n * The anchor of the tooltip\n * @param children\n */\nfunction TooltipAnchor({ children }: Readonly<PropsWithChildren>): JSX.Element {\n  const context = useTooltipContext();\n\n  // The children can have a ref and we don't want to discard it\n  // Doing a dirty cast to get the optional ref\n  const childrenRef = (children as unknown as { ref?: Ref<HTMLElement> })?.ref;\n  const ref = useMergeRefs([context.refs.setReference, childrenRef]);\n\n  if (!isValidElement(children)) {\n    throw new Error(\"Tooltip anchor must be a single valid React element\");\n  }\n\n  return cloneElement(\n    children,\n    context.getReferenceProps({\n      ref,\n      ...children.props,\n      \"data-state\": context.open ? \"open\" : \"closed\",\n    }),\n  );\n}\n"],"names":["TooltipContext","createContext","useTooltipContext","context","useContext","useTooltip","controlledOpen","placement","setControlledOpen","isTriggerInteractive","caption","labelId","useId","captionId","arrowRef","useRef","uncontrolledOpen","setUncontrolledOpen","useState","open","setOpen","data","useFloating","autoUpdate","offset","flip","shift","arrow","hover","useHover","focus","useFocus","dismiss","useDismiss","role","useRole","interactions","useInteractions","useMemo","Tooltip","children","nonInteractiveTriggerTabIndex","label","props","jsxs","jsx","TooltipAnchor","TooltipContent","classNames","styles","floatingContext","rest","FloatingPortal","FloatingArrow","childrenRef","ref","useMergeRefs","isValidElement","cloneElement"],"mappings":"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"}